<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Book2Door - Follow your Order</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/assets/img/favicon.png}"/>
    <!-- Place favicon.ico in the root directory -->

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap-5.0.0-alpha-2.min.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/LineIcons.2.0.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/animate.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/main.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/custom.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/bookPage.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/order.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

<!-- ========================= preloader start ========================= -->
<div class="preloader">
    <div class="loader">
        <div class="ytp-spinner">
            <div class="ytp-spinner-container">
                <div class="ytp-spinner-rotator">
                    <div class="ytp-spinner-left">
                        <div class="ytp-spinner-circle"></div>
                    </div>
                    <div class="ytp-spinner-right">
                        <div class="ytp-spinner-circle"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- preloader end -->


<!-- ========================= header start ========================= -->
<header class="header">
    <div class="navbar-area">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg">
                        <a class="navbar-brand" th:href="@{/}">
                            <h3>Book2Door</h3>
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="toggler-icon"></span>
                            <span class="toggler-icon"></span>
                            <span class="toggler-icon"></span>
                        </button>

                        <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                            <ul id="nav" class="navbar-nav ml-auto">
                                <li class="nav-item">
                                    <a class="page-scroll" th:href="@{/}">Home</a>
                                </li>
                            </ul>
                        </div>
                        <!-- navbar collapse -->
                    </nav>
                    <!-- navbar -->
                </div>
            </div>
            <!-- row -->
        </div>
        <!-- container -->
    </div>
    <!-- navbar area -->
</header>
<!-- ========================= header end ========================= -->

<!-- ========================= hero-section start ========================= -->
<section id="login" class="hero-section">
    <div class="hero-shape">
        <img th:src="@{/assets/img/hero/hero-shape.svg}" alt="" class="shape">
    </div>
    <div class="container book">
        <h3 class="wow fadeInUp" data-wow-delay=".2s">Follow your Order</h3>
        <p style="display: none" th:text="${orderId}" id="orderId"></p>
        <p id="estimatedTime">Estimated time of arrival: 16:40-16:55</p>
        <div id="orderPlaced">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <div style="text-align: center; padding-top: 5%">
                            <h1 style="color: #91e0d2ff">Your order was placed!</h1>
                            <progress>Loading...</progress>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <img th:src="@{/assets/img/orderPlaced.png}">
                </div>
            </div>
        </div>
        <div id="orderPickedUp" style="display: none">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <div style="text-align: center; padding-top: 5%">
                            <h1 style="color: #91e0d2ff">Your order is being picked up by a rider!</h1>
                            <progress>Loading...</progress>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <img th:src="@{/assets/img/orderPickedUp.png}">
                </div>
            </div>
        </div>
        <div id="orderMap" style="display: none">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="hero-content">
                        <div style="text-align: center; padding-top: 5%">
                            <h1 style="color: #91e0d2ff">Your order is being delivered!</h1>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <!-- MAP here -->
                    <div class="mapouter">
                        <div class="gmap_canvas">
                            <iframe class="gmap_iframe" id="iframe" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src=""></iframe>
                        </div>
                        <style>.mapouter{position:relative;text-align:right;width:700px;height:500px;}.gmap_canvas {overflow:hidden;background:none!important;width:700px;height:500px;}.gmap_iframe {width:700px!important;height:500px!important;}</style>
                    </div>
                </div>
            </div>
        </div>
        <div id="orderReview" style="display: none; text-align: center">
            <div class="row align-items-center">
                    <div class="hero-content">
                        <div style="text-align: center; padding-top: 10%">
                            <h1 style="color: #91e0d2ff">Review your rider and order!</h1>
                        </div>
                    </div>
                    <div id="riderReview"  class="row align-items-center">
                        <ul id="childWrapper" style="text-align: center">
                            <li><i class="fas fa-thumbs-down fa-3x"></i></li>
                            <li><h2>Rider</h2></li>
                            <li><i class="fas fa-thumbs-up fa-3x"></i></li>
                        </ul>
                    </div>
                <div id="storeReview" class="row align-items-center">
                    <ul id="childWrapper2" style="text-align: center">
                        <li><i class="fas fa-thumbs-down fa-3x"></i></li>
                        <li><h2>Store</h2></li>
                        <li><i class="fas fa-thumbs-up fa-3x"></i></li>
                    </ul>

                </div>


            </div>
        </div>
    </div>

    </div>


</section>

<!-- ========================= hero-section end ========================= -->



<!-- ========================= JS here ========================= -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>

    var orderid = document.getElementById("orderId").innerText;
    var interval = 4000;
    console.log(orderid);
    function doAjax() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/order/" + orderid,
            dataType: "json",
            success: function (data) {
                console.log(data);
                var locationRiderLat = data.pickupRider.location[0];
                var locationRiderLon = data.pickupRider.location[1];

                //data will hold an object with your response data, no need to parse
                if (data.status == 'ASSIGNED') {
                    changeDiv();
                } else if (data.status == 'BEING_DELIVERED') {
                    changeDiv2();
                   document.getElementById('iframe').src = "https://maps.google.com/maps?q="+ locationRiderLat +",%20" + locationRiderLon +"&t=&z=13&ie=UTF8&iwloc=&output=embed";
                } else if (data.status == 'DELIVERED') {
                    changeDiv3();
                }
            },
            complete: function (data) {
                // Schedule the next
                setTimeout(doAjax, interval);
            }
        })
    }
    setTimeout(doAjax, interval);





    function changeDiv() {
        document.getElementById("orderPickedUp").style.display = "flex";
        document.getElementById("orderPlaced").style.display = "none";
    }

    function changeDiv2() {
        document.getElementById("orderPickedUp").style.display = "none";
        document.getElementById("orderMap").style.display = "flex";
    }

    function changeDiv3() {
        document.getElementById("orderMap").style.display = "none";
        document.getElementById("orderReview").style.display = "flex";
        document.getElementById("estimatedTime").style.display = "none";
    }

    //let change = setTimeout(changeDiv, 1000);
    //let change2 = setTimeout(changeDiv2, 2000);
    //let change3 = setTimeout(changeDiv3, 3000);

</script>
<script th:src="@{/assets/js/bootstrap.5.0.0.alpha-2-min.js}"></script>
<script th:src="@{/assets/js/count-up.min.js}"></script>
<script th:src="@{/assets/js/wow.min.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>
</body>
</html>
